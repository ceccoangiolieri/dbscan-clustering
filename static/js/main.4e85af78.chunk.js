(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{283:function(e,t,a){e.exports=a(459)},458:function(e,t,a){},459:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(69),i=a(56),s=a(250),c=a(83),l=a(252),p=a(191),u=a(72),d=a(26),m=function(e){return function(t,a){var n,o,r=a().placesControls,i=r.boundingbox;if(r.places.hasOwnProperty(e.category)&&i==r.places[e.category].boundingbox&&r.places[e.category].next?n=r.places[e.category].next:(n=new URL("https://places.cit.api.here.com/places/v1/discover/explore"),o={app_id:"yATlKFDZwdLtjHzyTeCK",app_code:"0XXQyxbiCjVU7jN2URXuhg",in:i,size:20,cat:e.category}),n)return t(C({category:e.category})),o&&(n.search=new URLSearchParams(o)),fetch(n).then(function(e){return e.json()}).then(function(a){return t(v(a,e.category,i,e.color))}).catch(function(e){return console.error(e)})}},h=function(e){return{type:"RESULT_HANDLER",payload:e}},b=function(){return{type:"CLEAR"}},g=function(e){return function(t){var a=[e._southWest.lng,e._southWest.lat,e._northEast.lng,e._northEast.lat].join(",");t(f(a))}},f=function(e){return{type:"UPDATE_BBOX",payload:e}},y=function(){return{type:"COMPUTE_DBSCAN"}},v=function(e,t,a,n){return function(o){var r=o(function(e){return function(t){var a,n={};return(a=e.results?e.results:e).items.length>0&&(n.items=a.items),a.next?n.next=a.next:t(h({type:"warning",icon:"warning",description:"All places fetched in this bounding box. Try and zoom in or pan the map.",title:"No more places to fetch."})),n}}(e));o(E({data:r,category:t,boundingbox:a,color:n})),0==r.length&&o(h({type:"warning",icon:"warning",description:"No places in your viewport, zoom to another region and try again.",title:"DBScan settings"}))}},E=function(e){return{type:"RECEIVE_PLACES_RESULTS",payload:e}},C=function(e){return{type:"REQUEST_PLACES_RESULTS",payload:e}},x={boundingbox:"",message:{receivedAt:0},lastCall:Date.now(),places:{},dbscanSettings:{minPoints:10,maxDistance:500},lastCompute:0},O=Object(i.combineReducers)({placesControls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"DISABLE_PLACES":return Object(d.a)({},e,{places:Object(d.a)({},e.places,Object(u.a)({},t.payload,Object(d.a)({},e.places[t.payload],{disabled:!0})))});case"CLEAR":return Object(d.a)({},e,{places:{},lastCall:Date.now(),lastCompute:Date.now()});case"REQUEST_PLACES_RESULTS":return Object(d.a)({},e,{places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{isFetching:!0})))});case"RECEIVE_PLACES_RESULTS":return Object(d.a)({},e,{lastCall:Date.now(),places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{data:e.places[t.payload.category].hasOwnProperty("data")?[].concat(Object(p.a)(e.places[t.payload.category].data),Object(p.a)(t.payload.data.items)):t.payload.data.items,next:t.payload.data.next,previous:t.payload.data.previous,boundingbox:t.payload.boundingbox,color:t.payload.color,isFetching:!1,disabled:!t.payload.data.next})))});case"UPDATE_BBOX":var a=Object(d.a)({},e);for(var n in a.boundingbox=t.payload,a.places)a.places[n].disabled=!1,a.places[n].next=void 0,a.places[n].previous=void 0;return a;case"RESULT_HANDLER":return Object(d.a)({},e,{message:Object(d.a)({},e.message,t.payload,{receivedAt:Date.now()})});case"COMPUTE_DBSCAN":return Object(d.a)({},e,{lastCompute:Date.now()});case"UPDATE_DBSCAN_SETTINGS":return Object(d.a)({},e,{dbscanSettings:Object(d.a)({},e.dbscanSettings,Object(u.a)({},t.payload.setting,t.payload.value))});default:return e}}}),w=a(77),j=a(78),_=a(84),S=a(79),T=a(85),D=a(21),B=a.n(D),k=a(41),A=function(e,t,a){return B.a.geoJSON(e,{pointToLayer:function(e,t){switch(e.properties.type){case"edge":case"noise":return B.a.circleMarker(t)}},style:function(e){switch(e.properties.type){case"cluster":return{radius:8,fillColor:"black",weight:0,opacity:1,color:"black",pane:"clusterPane"};case"noise":return{radius:8,fillColor:"black",color:"black",weight:0,opacity:1,fillOpacity:.3};case"edge":return{radius:8,fillColor:"blue",color:"blue",weight:0,opacity:1,fillOpacity:.3}}}}).bindTooltip("<strong>DBScan information:</strong> "+(isNaN(a)?a:"Cluster "+(parseInt(a)+1))+(isNaN(a)?"":"<br/> <strong>Amount of points in cluster:</strong> "+t),{permanent:!1,sticky:!0})},P={};P.HERE=D.TileLayer.extend({options:{subdomains:"1234",minZoom:2,maxZoom:18,scheme:"normal.day",resource:"maptile",mapId:"newest",format:"png8",appId:"",appCode:""},initialize:function(e){var t=(e=D.setOptions(this,e)).scheme.split(".")[0];e.tileResolution=256,D.Browser.retina&&(e.tileResolution=512);var a="base.maps.api.here.com";"satellite"!=t&&"terrain"!=t&&"hybrid"!=t||(a="aerial.maps.api.here.com"),-1!==e.scheme.indexOf(".traffic.")&&(a="traffic.maps.api.here.com");var n="https://{s}."+a+"/{resource}/2.1/{resource}/{mapId}/{scheme}/{z}/{x}/{y}/{tileResolution}/{format}?app_id={appId}&app_code={appCode}";this._attributionUrl=D.Util.template("https://1."+a+"/maptile/2.1/copyright/{mapId}?app_id={appId}&app_code={appCode}",this.options),D.TileLayer.prototype.initialize.call(this,n,e),this._attributionText=""},onAdd:function(e){D.TileLayer.prototype.onAdd.call(this,e),this._attributionBBoxes||this._fetchAttributionBBoxes()},onRemove:function(e){D.TileLayer.prototype.onRemove.call(this,e),this._map.attributionControl.removeAttribution(this._attributionText),this._map.off("moveend zoomend resetview",this._findCopyrightBBox,this)},_fetchAttributionBBoxes:function(){var e=new XMLHttpRequest;e.onreadystatechange=D.bind(function(){4==e.readyState&&200==e.status&&this._parseAttributionBBoxes(JSON.parse(e.responseText))},this),e.open("GET",this._attributionUrl,!0),e.send()},_parseAttributionBBoxes:function(e){if(this._map){for(var t=e[this.options.scheme.split(".")[0]]||e.normal,a=0;a<t.length;a++)if(t[a].boxes)for(var n=0;n<t[a].boxes.length;n++){var o=t[a].boxes[n];t[a].boxes[n]=D.latLngBounds([[o[0],o[1]],[o[2],o[3]]])}this._map.on("moveend zoomend resetview",this._findCopyrightBBox,this),this._attributionProviders=t,this._findCopyrightBBox()}},_findCopyrightBBox:function(){if(this._map){for(var e=this._attributionProviders,t=[],a=this._map.getZoom(),n=this._map.getBounds(),o=0;o<e.length;o++){if(e[o].minLevel<a&&e[o].maxLevel>a&&!e[o].boxes){t.push(e[o]);break}for(var r=0;r<e[o].boxes.length;r++){var i=e[o].boxes[r];if(n.overlaps(i)){t.push(e[o]);break}}}for(var s=['<a href="https://legal.here.com/terms/serviceterms/gb/">HERE maps</a>'],c=0;c<t.length;c++){var l=t[c];s.push('<abbr title="'+l.alt+'">'+l.label+"</abbr>")}var p="\xa9 "+s.join(", ")+". ";p!==this._attributionText&&(this._map.attributionControl.removeAttribution(this._attributionText),this._map.attributionControl.addAttribution(this._attributionText=p))}}}),P.here=function(e){return new P.HERE(e)};var L={width:"100%",height:"100vh"},R=P.here({appId:"jKco7gLGf0WWlvS5n2fl",appCode:"HQnCztY23zh2xiTPCFiTMA",scheme:"reduced.day"}),N=B.a.featureGroup(),U=B.a.featureGroup(),z={center:[40.7569,-73.9837],zoomControl:!1,maxBounds:B.a.latLngBounds(B.a.latLng(-90,-180),B.a.latLng(90,180)),zoom:13,layers:[N,U,R]},M=function(e){function t(){return Object(w.a)(this,t),Object(_.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(j.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;this.map=B.a.map("map",z),this.map.createPane("clusterPane").style.opacity=.9;var a={"HERE Maps Tiles: reduced day":R},n={"Points of interest":N,Clusters:U};B.a.control.layers(a,n).addTo(this.map),B.a.control.zoom({position:"topright"}).addTo(this.map);var o=B.a.control({position:"bottomright"});o.onAdd=function(e){var t=B.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://gis.ops.com" target="_blank"><div class="gis-ops-logo"></a>',t};var r=B.a.control({position:"bottomright"});r.onAdd=function(e){var t=B.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://developer.here.com/" target="_blank"><div class="here-logo"></div></a>',t},this.map.addControl(o),this.map.addControl(r),this.map.on("moveend",function(){t(g(e.map.getBounds()))}),t(g(this.map.getBounds()))}},{key:"processClusters",value:function(e){var t=function(e){var t={},a=!0,n=!1,o=void 0;try{for(var r,i=e.features[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var s=r.value;"noise"===s.properties.dbscan||"edge"===s.properties.dbscan?t.hasOwnProperty(s.properties.dbscan)?t[s.properties.dbscan].push(s.geometry.coordinates):t[s.properties.dbscan]=[]:"core"===s.properties.dbscan&&(t.hasOwnProperty(s.properties.cluster)?t[s.properties.cluster].push(Object(k.point)(s.geometry.coordinates)):t[s.properties.cluster]=[])}}catch(c){n=!0,o=c}finally{try{a||null==i.return||i.return()}finally{if(n)throw o}}return t}(e);for(var a in t){var n=t[a].length,o=void 0;if("noise"!==a&&"edge"!==a)switch(!0){case n<=2:o=Object(k.multiPoint)(Object(k.featureCollection)(t[a]),{type:"cluster"});break;case 3==n:o=Object(k.polygon)(Object(k.featureCollection)(t[a]),{type:"cluster"});break;case n>3:(o=Object(k.concave)(Object(k.featureCollection)(t[a]))).properties.type="cluster"}else o=Object(k.multiPoint)(t[a],{type:a});A(o,n,a).addTo(U)}}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.lastCall,n=t.lastCompute,o=t.dbscanSettings;if(a>e.lastCall&&this.addPlaces(),n>e.lastCompute){U.clearLayers();var r=function(e,t){var a=t.maxDistance/1e3,n=t.minPoints;return Object(k.clustersDbscan)(e,a,{minPoints:n})}(N.toGeoJSON(),o);this.processClusters(r)}}},{key:"addPlaces",value:function(){N.clearLayers();var e=this.props.places,t=0;for(var a in e)if(e[a].hasOwnProperty("data")&&e[a].data.length>0){var n=!0,o=!1,r=void 0;try{for(var i,s=e[a].data[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;B.a.circleMarker([c.position[0],c.position[1]],{color:e[a].color,orig_color:e[a].color,radius:5,id:t,weight:1,opacity:.5}).addTo(N).bindTooltip(c.title),t+=1}}catch(l){o=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}}},{key:"render",value:function(){return o.a.createElement("div",{id:"map",style:L})}}]),t}(o.a.Component),I=Object(c.b)(function(e){var t=e.placesControls;return{places:t.places,lastCall:t.lastCall,lastCompute:t.lastCompute,dbscanSettings:t.dbscanSettings}})(M),H=a(253),G=a(189),J=a(248),F=a(76),X=a(138),W=a(105),Q=a(247),Z=a(246),K={zIndex:999,position:"absolute",width:"400px",top:"10px",left:"10px",maxHeight:"calc(100vh - 3vw)",overflow:"auto",padding:"20px"},V={0:{name:"shopping",color:"red"},1:{name:"accommodation",color:"orange"},2:{name:"administrative-areas-buildings",color:"yellow"},3:{name:"airport",color:"olive"},4:{name:"atm-bank-exchange",color:"green"},5:{name:"coffee-tea",color:"teal"},6:{name:"eat-drink",color:"blue"},7:{name:"going-out",color:"violet"},8:{name:"hospital-health-care-facility",color:"purple"},9:{name:"leisure-outdoor",color:"pink"},10:{name:"natural-geographical",color:"brown"},11:{name:"petrol-station"},12:{name:"restaurant",color:"grey"},13:{name:"snacks-fast-food",color:"black"},14:{name:"sights-museums",color:"red"},16:{name:"toilet-rest-area",color:"yellow"},17:{name:"transport",color:"olive"}},q=function(e){var t=e.name,a=e.min,n=e.max,r=e.step,i=e.start,s=e.value,c=e.dispatch;return o.a.createElement(H.Slider,{discrete:!0,color:"grey",settings:{start:i,value:s,min:a,max:n,step:r,onChange:function(e){var a;c((a={setting:t,value:e},{type:"UPDATE_DBSCAN_SETTINGS",payload:Object(d.a)({},a)}))}}})},Y=function(e){var t=e.content,a=e.value;return o.a.createElement(J.a,{content:t,trigger:o.a.createElement(F.a,{size:"tiny"},a)})},$=function(e){function t(){var e,a;Object(w.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(_.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e,t){(0,a.props.dispatch)(m({category:t.name,color:t.color}))},a.handleClickDbscan=function(){(0,a.props.dispatch)(y())},a.handleClickClear=function(){(0,a.props.dispatch)(b())},a.componentDidUpdate=function(e){var t=a.props.message;t.receivedAt>e.message.receivedAt&&Object(G.toast)({type:t.type,icon:t.icon,title:t.topic,description:t.description,time:5e3})},a.areButtonsDisabled=function(e){var t=!0;for(var a in e)e.hasOwnProperty(a)&&e[a].hasOwnProperty("data")&&e[a].data.length>0&&(t=!1);return t},a}return Object(T.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.places,n=t.dbscanSettings,r=t.dispatch,i=function(e){var t=e.content,a=e.circular,n=e.popupContent,r=e.handler,i=e.name,s=e.icon,c=(e.value,e.disabled),l=e.basic,p=e.size,u=e.loading,d=e.color;return o.a.createElement(J.a,{content:n,size:p,trigger:o.a.createElement(X.a,{color:d,circular:a,content:t,loading:u,name:i,size:p,onClick:r,basic:l,disabled:c,icon:s})})};return o.a.createElement("div",null,o.a.createElement(W.a,{style:K},o.a.createElement("div",null,o.a.createElement("span",null,o.a.createElement(Q.a,{as:"h4"},"DBScan with HERE Maps places and TurfJS"),o.a.createElement("p",null,"Density-based spatial clustering of applications with noise (",o.a.createElement("a",{href:"https://en.wikipedia.org/wiki/DBSCAN",rel:"noopener noreferrer",target:"_blank"},"DBScan"),") is a data clustering algorithm. Given a set of points in some space, it groups together points that are closely packed together (points with many nearby neighbors), marking as outliers points that lie alone in low-density regions (whose nearest neighbors are too far away)."),o.a.createElement("p",null,"This application consumes"," ",o.a.createElement("a",{href:"https://developer.here.com/api-explorer/rest/places",target:"_blank",rel:"noopener noreferrer"},"HERE Maps places API")," ","for given categories as point input for the clustering algorithm which is implemented in",o.a.createElement("a",{href:"https://turfjs.org/docs/#clustersDbscan",target:"_blank",rel:"noopener noreferrer"},"TurfJS"),"."))),o.a.createElement(Q.a,{as:"h5"},"DBScan settings"),o.a.createElement("div",{className:"flex flex-row"},o.a.createElement("div",{className:"w-80"},o.a.createElement(q,{name:"maxDistance",min:100,max:5e3,step:50,start:n.maxDistance,value:n.maxDistance,dispatch:r}),o.a.createElement("div",{className:"mt2"},o.a.createElement(Y,{value:"Max. distance: "+n.maxDistance,content:"Maximum Distance \u03b5 between any point of the cluster to generate the clusters"}))),o.a.createElement("div",{className:"w-80"},o.a.createElement(q,{name:"minPoints",min:3,max:50,step:1,start:n.minPoints,value:n.minPoints,dispatch:r}),o.a.createElement("div",{className:"mt2"},o.a.createElement(Y,{value:"Min. points: "+n.minPoints,content:"Minimum number of points to generate a single cluster, points which do not meet this requirement will be classified as an 'edge' or 'noise'."}))),o.a.createElement("div",{className:"w-20"},o.a.createElement(i,{basic:!0,size:"tiny",icon:"whmcs",circular:!0,popupContent:"Compute DBScan",disabled:this.areButtonsDisabled(a),handler:this.handleClickDbscan}))),o.a.createElement(Z.a,null),o.a.createElement("div",null,Object.keys(V).map(function(t,n){var r=V[t].name;return a[V[t].name]&&!a[V[t].name].disabled&&a[V[t].name].next&&(r="fetch more.."),o.a.createElement("div",{key:n,className:"mt1 dib"},o.a.createElement(i,{icon:!1,popupContent:"Fetch places of this category",content:r,name:V[t].name,handler:e.handleClick,color:V[t].color,disabled:!!a[V[t].name]&&a[V[t].name].disabled,loading:!!a[V[t].name]&&a[V[t].name].isFetching,size:"tiny"}))}),o.a.createElement("div",{className:"mt2"},o.a.createElement(i,{icon:"remove",size:"tiny",popupContent:"Reset places and map",handler:this.handleClickClear,disabled:this.areButtonsDisabled(a)})))),o.a.createElement(G.SemanticToastContainer,{position:"bottom-center"}))}}]),t}(o.a.Component),ee=Object(c.b)(function(e){var t=e.placesControls,a=t.places,n=t.dbscanSettings;return{places:a,boundingbox:t.boundingbox,dbscanSettings:n,message:t.message}})($),te=function(e){function t(){return Object(w.a)(this,t),Object(_.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(I,null),o.a.createElement(ee,null))}}]),t}(o.a.Component),ae=(a(458),[l.a]),ne=Object(i.createStore)(O,Object(s.composeWithDevTools)(i.applyMiddleware.apply(void 0,ae)));Object(r.render)(o.a.createElement(c.a,{store:ne}," ",o.a.createElement(te,null)),document.getElementById("root"))}},[[283,1,2]]]);
//# sourceMappingURL=main.4e85af78.chunk.js.map