(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{283:function(e,t,a){e.exports=a(459)},458:function(e,t,a){},459:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(69),i=a(56),s=a(250),c=a(82),l=a(252),p=a(191),u=a(85),d=a(31),m=function(e){return function(t,a){t(E({category:e.category}));var n=a().placesControls.boundingbox,o=new URL("https://places.demo.api.here.com/places/v1/discover/explore"),r={app_id:"yATlKFDZwdLtjHzyTeCK",app_code:"0XXQyxbiCjVU7jN2URXuhg",in:n,size:500,cat:e.category};return o.search=new URLSearchParams(r),fetch(o).then(function(e){return e.json()}).then(function(a){return t(y(a,e.category,n,e.color))}).catch(function(e){return console.error(e)})}},h=function(){return{type:"CLEAR"}},b=function(e){return function(t){var a=[e._southWest.lng,e._southWest.lat,e._northEast.lng,e._northEast.lat].join(",");t(g(a))}},g=function(e){return{type:"UPDATE_BBOX",payload:e}},f=function(){return{type:"COMPUTE_DBSCAN"}},y=function(e,t,a,n){return function(o){var r=function(e){return e.results&&e.results.items.length>0?e.results.items:[]}(e);o(v({data:r,category:t,boundingbox:a,color:n})),0==r.length&&o({type:"RESULT_HANDLER",payload:{type:"info",icon:"warning",description:"No places in your viewport, zoom to another region and try again.",title:"DBScan settings"}})}},v=function(e){return{type:"RECEIVE_PLACES_RESULTS",payload:e}},E=function(e){return{type:"REQUEST_PLACES_RESULTS",payload:e}},C={boundingbox:"",message:{receivedAt:0},lastCall:Date.now(),places:{},dbscanSettings:{minPoints:10,maxDistance:500},lastCompute:0},O=Object(i.combineReducers)({placesControls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR":return Object(d.a)({},e,{places:{},lastCall:Date.now(),lastCompute:Date.now()});case"REQUEST_PLACES_RESULTS":return Object(d.a)({},e,{places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{isFetching:!0})))});case"RECEIVE_PLACES_RESULTS":return Object(d.a)({},e,{lastCall:Date.now(),places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{data:e.places[t.payload.category].hasOwnProperty("data")?[].concat(Object(p.a)(e.places[t.payload.category].data),Object(p.a)(t.payload.data)):t.payload.data,boundingbox:t.payload.boundingbox,color:t.payload.color,isFetching:!1})))});case"UPDATE_BBOX":return Object(d.a)({},e,{boundingbox:t.payload});case"RESULT_HANDLER":return Object(d.a)({},e,{message:Object(d.a)({},e.message,t.payload,{receivedAt:Date.now()})});case"COMPUTE_DBSCAN":return Object(d.a)({},e,{lastCompute:Date.now()});case"UPDATE_DBSCAN_SETTINGS":return Object(d.a)({},e,{dbscanSettings:Object(d.a)({},e.dbscanSettings,Object(u.a)({},t.payload.setting,t.payload.value))});default:return e}}}),w=a(76),x=a(77),_=a(83),j=a(78),S=a(84),T=a(21),D=a.n(T),B=a(41),k=function(e,t,a){return D.a.geoJSON(e,{pointToLayer:function(e,t){switch(e.properties.type){case"edge":case"noise":return D.a.circleMarker(t)}},style:function(e){switch(e.properties.type){case"cluster":return{radius:8,fillColor:"black",weight:0,opacity:1,color:"black",pane:"clusterPane"};case"noise":return{radius:8,fillColor:"black",color:"black",weight:0,opacity:1,fillOpacity:.3};case"edge":return{radius:8,fillColor:"blue",color:"blue",weight:0,opacity:1,fillOpacity:.3}}}}).bindTooltip("<strong>DBScan information:</strong> "+(isNaN(a)?a:"Cluster "+(parseInt(a)+1))+(isNaN(a)?"":"<br/> <strong>Amount of points in cluster:</strong> "+t),{permanent:!1,sticky:!0})},A={};A.HERE=T.TileLayer.extend({options:{subdomains:"1234",minZoom:2,maxZoom:18,scheme:"normal.day",resource:"maptile",mapId:"newest",format:"png8",appId:"",appCode:""},initialize:function(e){var t=(e=T.setOptions(this,e)).scheme.split(".")[0];e.tileResolution=256,T.Browser.retina&&(e.tileResolution=512);var a="base.maps.api.here.com";"satellite"!=t&&"terrain"!=t&&"hybrid"!=t||(a="aerial.maps.api.here.com"),-1!==e.scheme.indexOf(".traffic.")&&(a="traffic.maps.api.here.com");var n="https://{s}."+a+"/{resource}/2.1/{resource}/{mapId}/{scheme}/{z}/{x}/{y}/{tileResolution}/{format}?app_id={appId}&app_code={appCode}";this._attributionUrl=T.Util.template("https://1."+a+"/maptile/2.1/copyright/{mapId}?app_id={appId}&app_code={appCode}",this.options),T.TileLayer.prototype.initialize.call(this,n,e),this._attributionText=""},onAdd:function(e){T.TileLayer.prototype.onAdd.call(this,e),this._attributionBBoxes||this._fetchAttributionBBoxes()},onRemove:function(e){T.TileLayer.prototype.onRemove.call(this,e),this._map.attributionControl.removeAttribution(this._attributionText),this._map.off("moveend zoomend resetview",this._findCopyrightBBox,this)},_fetchAttributionBBoxes:function(){var e=new XMLHttpRequest;e.onreadystatechange=T.bind(function(){4==e.readyState&&200==e.status&&this._parseAttributionBBoxes(JSON.parse(e.responseText))},this),e.open("GET",this._attributionUrl,!0),e.send()},_parseAttributionBBoxes:function(e){if(this._map){for(var t=e[this.options.scheme.split(".")[0]]||e.normal,a=0;a<t.length;a++)if(t[a].boxes)for(var n=0;n<t[a].boxes.length;n++){var o=t[a].boxes[n];t[a].boxes[n]=T.latLngBounds([[o[0],o[1]],[o[2],o[3]]])}this._map.on("moveend zoomend resetview",this._findCopyrightBBox,this),this._attributionProviders=t,this._findCopyrightBBox()}},_findCopyrightBBox:function(){if(this._map){for(var e=this._attributionProviders,t=[],a=this._map.getZoom(),n=this._map.getBounds(),o=0;o<e.length;o++){if(e[o].minLevel<a&&e[o].maxLevel>a&&!e[o].boxes){t.push(e[o]);break}for(var r=0;r<e[o].boxes.length;r++){var i=e[o].boxes[r];if(n.overlaps(i)){t.push(e[o]);break}}}for(var s=['<a href="https://legal.here.com/terms/serviceterms/gb/">HERE maps</a>'],c=0;c<t.length;c++){var l=t[c];s.push('<abbr title="'+l.alt+'">'+l.label+"</abbr>")}var p="\xa9 "+s.join(", ")+". ";p!==this._attributionText&&(this._map.attributionControl.removeAttribution(this._attributionText),this._map.attributionControl.addAttribution(this._attributionText=p))}}}),A.here=function(e){return new A.HERE(e)};var P={width:"100%",height:"100vh"},L=A.here({appId:"jKco7gLGf0WWlvS5n2fl",appCode:"HQnCztY23zh2xiTPCFiTMA",scheme:"reduced.day"}),R=D.a.featureGroup(),N=D.a.featureGroup(),U={center:[40.7569,-73.9837],zoomControl:!1,maxBounds:D.a.latLngBounds(D.a.latLng(-90,-180),D.a.latLng(90,180)),zoom:13,layers:[R,N,L]},z=function(e){function t(){return Object(w.a)(this,t),Object(_.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(x.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;this.map=D.a.map("map",U),this.map.createPane("clusterPane").style.opacity=.9;var a={"HERE Maps Tiles: reduced day":L},n={"Points of interest":R,Clusters:N};D.a.control.layers(a,n).addTo(this.map),D.a.control.zoom({position:"topright"}).addTo(this.map);var o=D.a.control({position:"bottomright"});o.onAdd=function(e){var t=D.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://gis.ops.com" target="_blank"><div class="gis-ops-logo"></a>',t};var r=D.a.control({position:"bottomright"});r.onAdd=function(e){var t=D.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://developer.here.com/" target="_blank"><div class="here-logo"></div></a>',t},this.map.addControl(o),this.map.addControl(r),this.map.on("moveend",function(){t(b(e.map.getBounds()))}),t(b(this.map.getBounds()))}},{key:"processClusters",value:function(e){var t=function(e){var t={},a=!0,n=!1,o=void 0;try{for(var r,i=e.features[Symbol.iterator]();!(a=(r=i.next()).done);a=!0){var s=r.value;"noise"===s.properties.dbscan||"edge"===s.properties.dbscan?t.hasOwnProperty(s.properties.dbscan)?t[s.properties.dbscan].push(s.geometry.coordinates):t[s.properties.dbscan]=[]:"core"===s.properties.dbscan&&(t.hasOwnProperty(s.properties.cluster)?t[s.properties.cluster].push(Object(B.point)(s.geometry.coordinates)):t[s.properties.cluster]=[])}}catch(c){n=!0,o=c}finally{try{a||null==i.return||i.return()}finally{if(n)throw o}}return t}(e);for(var a in t){var n=t[a].length,o=void 0;if("noise"!==a&&"edge"!==a)switch(!0){case n<=2:o=Object(B.multiPoint)(Object(B.featureCollection)(t[a]),{type:"cluster"});break;case 3==n:o=Object(B.polygon)(Object(B.featureCollection)(t[a]),{type:"cluster"});break;case n>3:(o=Object(B.concave)(Object(B.featureCollection)(t[a]))).properties.type="cluster"}else o=Object(B.multiPoint)(t[a],{type:a});k(o,n,a).addTo(N)}}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.lastCall,n=t.lastCompute,o=t.dbscanSettings;if(a>e.lastCall&&this.addPlaces(),n>e.lastCompute){N.clearLayers();var r=function(e,t){var a=t.maxDistance/1e3,n=t.minPoints;return Object(B.clustersDbscan)(e,a,{minPoints:n})}(R.toGeoJSON(),o);this.processClusters(r)}}},{key:"addPlaces",value:function(){R.clearLayers();var e=this.props.places,t=0;for(var a in e)if(e[a].hasOwnProperty("data")&&e[a].data.length>0){var n=!0,o=!1,r=void 0;try{for(var i,s=e[a].data[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;D.a.circleMarker([c.position[0],c.position[1]],{color:e[a].color,orig_color:e[a].color,radius:5,id:t,weight:1,opacity:.5}).addTo(R).bindTooltip(c.title),t+=1}}catch(l){o=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}}},{key:"render",value:function(){return o.a.createElement("div",{id:"map",style:P})}}]),t}(o.a.Component),M=Object(c.b)(function(e){var t=e.placesControls;return{places:t.places,lastCall:t.lastCall,lastCompute:t.lastCompute,dbscanSettings:t.dbscanSettings}})(z),I=a(253),H=a(189),G=a(248),J=a(75),F=a(138),X=a(105),W=a(247),Q=a(246),Z={zIndex:999,position:"absolute",width:"400px",top:"10px",left:"10px",maxHeight:"calc(100vh - 3vw)",overflow:"auto",padding:"20px"},K={0:{name:"shopping",color:"red"},1:{name:"accommodation",color:"orange"},2:{name:"administrative-areas-buildings",color:"yellow"},3:{name:"airport",color:"olive"},4:{name:"atm-bank-exchange",color:"green"},5:{name:"coffee-tea",color:"teal"},6:{name:"eat-drink",color:"blue"},7:{name:"going-out",color:"violet"},8:{name:"hospital-health-care-facility",color:"purple"},9:{name:"leisure-outdoor",color:"pink"},10:{name:"natural-geographical",color:"brown"},11:{name:"petrol-station"},12:{name:"restaurant",color:"grey"},13:{name:"snacks-fast-food",color:"black"},14:{name:"sights-museums",color:"red"},16:{name:"toilet-rest-area",color:"yellow"},17:{name:"transport",color:"olive"}},V=function(e){var t=e.name,a=e.min,n=e.max,r=e.step,i=e.start,s=e.value,c=e.dispatch;return o.a.createElement(I.Slider,{discrete:!0,color:"grey",settings:{start:i,value:s,min:a,max:n,step:r,onChange:function(e){var a;c((a={setting:t,value:e},{type:"UPDATE_DBSCAN_SETTINGS",payload:Object(d.a)({},a)}))}}})},q=function(e){var t=e.content,a=e.value;return o.a.createElement(G.a,{content:t,trigger:o.a.createElement(J.a,{size:"tiny"},a)})},Y=function(e){function t(){var e,a;Object(w.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(_.a)(this,(e=Object(j.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e,t){(0,a.props.dispatch)(m({category:t.content,color:t.color}))},a.handleClickDbscan=function(){(0,a.props.dispatch)(f())},a.handleClickClear=function(){(0,a.props.dispatch)(h())},a.componentDidUpdate=function(e){var t=a.props.message;t.receivedAt>e.message.receivedAt&&Object(H.toast)({type:t.type,icon:t.icon,title:t.topic,description:t.description,time:5e3})},a.areButtonsDisabled=function(e){var t=!0;for(var a in e)e.hasOwnProperty(a)&&e[a].hasOwnProperty("data")&&e[a].data.length>0&&(t=!1);return t},a}return Object(S.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.places,n=t.boundingbox,r=t.dbscanSettings,i=t.dispatch,s=function(e){var t=e.content,a=e.circular,n=e.popupContent,r=e.handler,i=e.icon,s=(e.value,e.disabled),c=e.basic,l=e.size,p=e.loading,u=e.color;return o.a.createElement(G.a,{content:n,size:l,trigger:o.a.createElement(F.a,{color:u,circular:a,content:t,loading:p,size:l,onClick:r,basic:c,disabled:s,icon:i})})};return o.a.createElement("div",null,o.a.createElement(X.a,{style:Z},o.a.createElement("div",null,o.a.createElement("span",null,o.a.createElement(W.a,{as:"h4"},"DBScan with HERE Maps places and TurfJS"),o.a.createElement("p",null,"Density-based spatial clustering of applications with noise (",o.a.createElement("a",{href:"https://en.wikipedia.org/wiki/DBSCAN",rel:"noopener noreferrer",target:"_blank"},"DBScan"),") is a data clustering algorithm. Given a set of points in some space, it groups together points that are closely packed together (points with many nearby neighbors), marking as outliers points that lie alone in low-density regions (whose nearest neighbors are too far away)."),o.a.createElement("p",null,"This application consumes"," ",o.a.createElement("a",{href:"https://developer.here.com/api-explorer/rest/places",target:"_blank",rel:"noopener noreferrer"},"HERE Maps places API")," ","for given categories as point input for the clustering algorithm which is implemented in",o.a.createElement("a",{href:"https://turfjs.org/docs/#clustersDbscan",target:"_blank",rel:"noopener noreferrer"},"TurfJS"),"."))),o.a.createElement(W.a,{as:"h5"},"DBScan settings"),o.a.createElement("div",{className:"flex flex-row"},o.a.createElement("div",{className:"w-80"},o.a.createElement(V,{name:"maxDistance",min:100,max:5e3,step:50,start:r.maxDistance,value:r.maxDistance,dispatch:i}),o.a.createElement("div",{className:"mt2"},o.a.createElement(q,{value:"Max. distance: "+r.maxDistance,content:"Maximum Distance \u03b5 between any point of the cluster to generate the clusters"}))),o.a.createElement("div",{className:"w-80"},o.a.createElement(V,{name:"minPoints",min:3,max:50,step:1,start:r.minPoints,value:r.minPoints,dispatch:i}),o.a.createElement("div",{className:"mt2"},o.a.createElement(q,{value:"Min. points: "+r.minPoints,content:"Minimum number of points to generate a single cluster, points which do not meet this requirement will be classified as an 'edge' or 'noise'."}))),o.a.createElement("div",{className:"w-20"},o.a.createElement(s,{basic:!0,size:"tiny",icon:"whmcs",circular:!0,popupContent:"Compute DBScan",disabled:this.areButtonsDisabled(a),handler:this.handleClickDbscan}))),o.a.createElement(Q.a,null),o.a.createElement("div",null,Object.keys(K).map(function(t,r){var i=!1;return a.hasOwnProperty(K[t].name)&&n===a[K[t].name].boundingbox&&(i=!0),o.a.createElement("div",{key:r,className:"mt1 dib"},o.a.createElement(s,{icon:!1,popupContent:"Fetch places of this category",content:K[t].name,handler:e.handleClick,color:K[t].color,disabled:i,loading:!!a[K[t].name]&&a[K[t].name].isFetching,size:"tiny"}))}),o.a.createElement("div",{className:"mt2"},o.a.createElement(s,{icon:"remove",size:"tiny",popupContent:"Reset places and map",handler:this.handleClickClear,disabled:this.areButtonsDisabled(a)})))),o.a.createElement(H.SemanticToastContainer,{position:"bottom-center"}))}}]),t}(o.a.Component),$=Object(c.b)(function(e){var t=e.placesControls,a=t.places,n=t.dbscanSettings;return{places:a,boundingbox:t.boundingbox,dbscanSettings:n,message:t.message}})(Y),ee=function(e){function t(){return Object(w.a)(this,t),Object(_.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(x.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(M,null),o.a.createElement($,null))}}]),t}(o.a.Component),te=(a(458),[l.a]),ae=Object(i.createStore)(O,Object(s.composeWithDevTools)(i.applyMiddleware.apply(void 0,te)));Object(r.render)(o.a.createElement(c.a,{store:ae}," ",o.a.createElement(ee,null)),document.getElementById("root"))}},[[283,1,2]]]);
//# sourceMappingURL=main.53bfbe6f.chunk.js.map