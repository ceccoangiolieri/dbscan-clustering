(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{286:function(e,t,a){e.exports=a(462)},461:function(e,t,a){},462:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(68),i=a(55),s=a(252),c=a(81),l=a(254),p=a(192),u=a(84),d=a(32),m=function(e){return function(t,a){t(E({category:e.category}));var n=a().placesControls.boundingbox,o=new URL("https://places.demo.api.here.com/places/v1/discover/explore"),r={app_id:"yATlKFDZwdLtjHzyTeCK",app_code:"0XXQyxbiCjVU7jN2URXuhg",in:n,size:500,cat:e.category};return o.search=new URLSearchParams(r),fetch(o).then(function(e){return e.json()}).then(function(a){return t(y(a,e.category,n,e.color))}).catch(function(e){return console.error(e)})}},h=function(e){return function(t){var a=[e._southWest.lng,e._southWest.lat,e._northEast.lng,e._northEast.lat].join(",");t(b(a))}},b=function(e){return{type:"UPDATE_BBOX",payload:e}},g=function(){return{type:"COMPUTE_DBSCAN"}},f=function(e){return{type:"UPDATE_DBSCAN_SETTINGS",payload:Object(d.a)({},e)}},y=function(e,t,a,n){return function(o){var r=function(e){return e.results&&e.results.items.length>0?e.results.items:[]}(e);o(v({data:r,category:t,boundingbox:a,color:n}))}},v=function(e){return{type:"RECEIVE_PLACES_RESULTS",payload:e}},E=function(e){return{type:"REQUEST_PLACES_RESULTS",payload:e}},C={boundingbox:"",message:{receivedAt:0},lastCall:Date.now(),places:{},dbscanSettings:{minPoints:10,maxDistance:500},lastCompute:0},x=Object(i.combineReducers)({placesControls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESULT_HANDLER":return Object(d.a)({},e,{message:Object(d.a)({},e.message,t.payload,{receivedAt:Date.now()})});case"COMPUTE_DBSCAN":return Object(d.a)({},e,{lastCompute:Date.now()});case"UPDATE_DBSCAN_SETTINGS":return Object(d.a)({},e,{dbscanSettings:Object(d.a)({},e.dbscanSettings,Object(u.a)({},t.payload.setting,t.payload.value))});case"UPDATE_BBOX":return Object(d.a)({},e,{boundingbox:t.payload});case"REQUEST_PLACES_RESULTS":return Object(d.a)({},e,{places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{isFetching:!0})))});case"RECEIVE_PLACES_RESULTS":return Object(d.a)({},e,{lastCall:Date.now(),places:Object(d.a)({},e.places,Object(u.a)({},t.payload.category,Object(d.a)({},e.places[t.payload.category],{data:e.places[t.payload.category].hasOwnProperty("data")?[].concat(Object(p.a)(e.places[t.payload.category].data),Object(p.a)(t.payload.data)):t.payload.data,boundingbox:t.payload.boundingbox,color:t.payload.color,isFetching:!1})))});default:return e}}}),O=a(75),_=a(76),j=a(82),w=a(77),S=a(83),T=a(24),D=a.n(T),B=a(87),k={};k.HERE=T.TileLayer.extend({options:{subdomains:"1234",minZoom:2,maxZoom:18,scheme:"normal.day",resource:"maptile",mapId:"newest",format:"png8",appId:"",appCode:""},initialize:function(e){var t=(e=T.setOptions(this,e)).scheme.split(".")[0];e.tileResolution=256,T.Browser.retina&&(e.tileResolution=512);var a="base.maps.api.here.com";"satellite"!=t&&"terrain"!=t&&"hybrid"!=t||(a="aerial.maps.api.here.com"),-1!==e.scheme.indexOf(".traffic.")&&(a="traffic.maps.api.here.com");var n="https://{s}."+a+"/{resource}/2.1/{resource}/{mapId}/{scheme}/{z}/{x}/{y}/{tileResolution}/{format}?app_id={appId}&app_code={appCode}";this._attributionUrl=T.Util.template("https://1."+a+"/maptile/2.1/copyright/{mapId}?app_id={appId}&app_code={appCode}",this.options),T.TileLayer.prototype.initialize.call(this,n,e),this._attributionText=""},onAdd:function(e){T.TileLayer.prototype.onAdd.call(this,e),this._attributionBBoxes||this._fetchAttributionBBoxes()},onRemove:function(e){T.TileLayer.prototype.onRemove.call(this,e),this._map.attributionControl.removeAttribution(this._attributionText),this._map.off("moveend zoomend resetview",this._findCopyrightBBox,this)},_fetchAttributionBBoxes:function(){var e=new XMLHttpRequest;e.onreadystatechange=T.bind(function(){4==e.readyState&&200==e.status&&this._parseAttributionBBoxes(JSON.parse(e.responseText))},this),e.open("GET",this._attributionUrl,!0),e.send()},_parseAttributionBBoxes:function(e){if(this._map){for(var t=e[this.options.scheme.split(".")[0]]||e.normal,a=0;a<t.length;a++)if(t[a].boxes)for(var n=0;n<t[a].boxes.length;n++){var o=t[a].boxes[n];t[a].boxes[n]=T.latLngBounds([[o[0],o[1]],[o[2],o[3]]])}this._map.on("moveend zoomend resetview",this._findCopyrightBBox,this),this._attributionProviders=t,this._findCopyrightBBox()}},_findCopyrightBBox:function(){if(this._map){for(var e=this._attributionProviders,t=[],a=this._map.getZoom(),n=this._map.getBounds(),o=0;o<e.length;o++){if(e[o].minLevel<a&&e[o].maxLevel>a&&!e[o].boxes){t.push(e[o]);break}for(var r=0;r<e[o].boxes.length;r++){var i=e[o].boxes[r];if(n.overlaps(i)){t.push(e[o]);break}}}for(var s=['<a href="https://legal.here.com/terms/serviceterms/gb/">HERE maps</a>'],c=0;c<t.length;c++){var l=t[c];s.push('<abbr title="'+l.alt+'">'+l.label+"</abbr>")}var p="\xa9 "+s.join(", ")+". ";p!==this._attributionText&&(this._map.attributionControl.removeAttribution(this._attributionText),this._map.attributionControl.addAttribution(this._attributionText=p))}}}),k.here=function(e){return new k.HERE(e)};var A=k,P=a(255),L=a.n(P),R={width:"100%",height:"100vh"},U=A.here({appId:"jKco7gLGf0WWlvS5n2fl",appCode:"HQnCztY23zh2xiTPCFiTMA",scheme:"reduced.day"}),N=D.a.featureGroup(),z=D.a.featureGroup(),I=D.a.latLng(-90,-180),M=D.a.latLng(90,180),H={center:[40.7569,-73.9837],zoomControl:!1,maxBounds:D.a.latLngBounds(I,M),zoom:13,layers:[N,z,U]},F=function(e){function t(){return Object(O.a)(this,t),Object(j.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;this.map=D.a.map("map",H),this.map.createPane("clusterPane").style.opacity=.9;var a={"HERE reduced.day":U},n={"Points of interest":N,Clusters:z};D.a.control.layers(a,n).addTo(this.map),D.a.control.zoom({position:"topright"}).addTo(this.map);var o=D.a.control({position:"bottomright"});o.onAdd=function(e){var t=D.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://gis.ops.com" target="_blank"><div class="gis-ops-logo"></a>',t};var r=D.a.control({position:"bottomright"});r.onAdd=function(e){var t=D.a.DomUtil.create("div","brand");return t.innerHTML='<a href="https://developer.here.com/" target="_blank"><div class="here-logo"></div></a>',t},this.map.addControl(r),this.map.addControl(o),this.map.on("moveend",function(){t(h(e.map.getBounds()))});var i=this.map.getBounds();t(h(i))}},{key:"processClusters",value:function(e){var t=this.props.dispatch;z.clearLayers();var a={},n=!0,o=!1,r=void 0;try{for(var i,s=e.features[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;"noise"===c.properties.dbscan||"edge"===c.properties.dbscan?a.hasOwnProperty(c.properties.dbscan)?a[c.properties.dbscan].push(Object(B.point)(c.geometry.coordinates)):a[c.properties.dbscan]=[]:"core"===c.properties.dbscan&&(a.hasOwnProperty(c.properties.cluster)?a[c.properties.cluster].push(Object(B.point)(c.geometry.coordinates)):a[c.properties.cluster]=[])}}catch(m){o=!0,r=m}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}var l=L.a.scale(["#919098","#FFCFD2","#A3C4BC","#DCEED1","#A8D4AD"]).mode("hsl").colors(Object.keys(a).length),p=0;if(1==Object.keys(a).length)t({type:"RESULT_HANDLER",payload:{type:"warning",icon:"warning",description:"No clusters found, try and change your settings",title:"DBScan settings"}});else for(var u in a){if("noise"!==u&&"edge"!==u){var d=Object(B.concave)(Object(B.featureCollection)(a[u]));a[u].length>0&&(D.a.geoJSON(d,{style:{fillColor:l[p],weight:2,opacity:1,color:l[p],pane:"clusterPane"}}).addTo(z).bindTooltip("<strong>Cluster number:</strong> "+(parseInt(u)+1)+"<br/> <strong>Amount of points in cluster:</strong> "+a[u].length,{permanent:!1,sticky:!0}).openTooltip(),z.bringToBack())}p+=1}}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.lastCall,n=t.lastCompute,o=t.dbscanSettings;if(a>e.lastCall&&this.addPlaces(),n>e.lastCompute){var r=N.toGeoJSON(),i=o.maxDistance/1e3,s=o.minPoints,c=Object(B.clustersDbscan)(r,i,{minPoints:s});this.processClusters(c)}}},{key:"addPlaces",value:function(){N.clearLayers();var e=this.props.places,t=0;for(var a in e)if(e[a].hasOwnProperty("data")&&e[a].data.length>0){var n=!0,o=!1,r=void 0;try{for(var i,s=e[a].data[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;D.a.circleMarker([c.position[0],c.position[1]],{color:e[a].color,orig_color:e[a].color,radius:5,id:t,weight:1}).addTo(N).bindTooltip(c.title),t+=1}}catch(l){o=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}}},{key:"render",value:function(){return o.a.createElement("div",{id:"map",style:R})}}]),t}(o.a.Component),G=Object(c.b)(function(e){var t=e.placesControls;return{places:t.places,lastCall:t.lastCall,lastCompute:t.lastCompute,dbscanSettings:t.dbscanSettings}})(F),J=a(256),X=a.n(J),W=a(189),Q=a(190),Z=a(105),K=a(248),V=a(250),q=a(74),Y=a(140),$=a(247),ee=a(249),te={zIndex:999,position:"absolute",width:"400px",top:"10px",left:"10px",maxHeight:"calc(100vh - 3vw)",overflow:"auto",padding:"20px"},ae={0:{name:"shopping",color:"red"},1:{name:"accommodation",color:"orange"},2:{name:"administrative-areas-buildings",color:"yellow"},3:{name:"airport",color:"olive"},4:{name:"atm-bank-exchange",color:"green"},5:{name:"coffee-tea",color:"teal"},6:{name:"eat-drink",color:"blue"},7:{name:"going-out",color:"violet"},8:{name:"hospital-health-care-facility",color:"purple"},9:{name:"leisure-outdoor",color:"pink"},10:{name:"natural-geographical",color:"brown"},11:{name:"petrol-station"},12:{name:"restaurant",color:"grey"},13:{name:"snacks-fast-food",color:"black"},14:{name:"sights-museums",color:"red"},16:{name:"toilet-rest-area",color:"yellow"},17:{name:"transport",color:"olive"}},ne=function(e){function t(){var e,a;Object(O.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(j.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(e,t){var n=a.props.dispatch;a.setState({value:t.name}),n(m({category:t.name,color:t.color}))},a.handleClickDbscan=function(e,t){(0,a.props.dispatch)(g())},a.componentDidUpdate=function(e){var t=a.props.message;t.receivedAt>e.message.receivedAt&&Object(Q.toast)({type:t.type,icon:t.icon,title:t.topic,description:t.description,time:5e3})},a}return Object(S.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.places,n=t.isCalculatingDbScan,r=t.boundingbox,i=t.dbscanSettings,s=t.dispatch;return o.a.createElement("div",null,o.a.createElement(Z.a,{style:te},o.a.createElement("div",null,o.a.createElement("span",null,o.a.createElement(K.a,{as:"h4"},"DBScan with HERE Maps places and TurfJS"),o.a.createElement("p",null,"Density-based spatial clustering of applications with noise (",o.a.createElement("a",{href:"https://en.wikipedia.org/wiki/DBSCAN",rel:"noopener noreferrer",target:"_blank"},"DBScan"),") is a data clustering algorithm. Given a set of points in some space, it groups together points that are closely packed together (points with many nearby neighbors), marking as outliers points that lie alone in low-density regions (whose nearest neighbors are too far away)."),o.a.createElement("p",null,"This application consumes"," ",o.a.createElement("a",{href:"https://developer.here.com/api-explorer/rest/places",target:"_blank",rel:"noopener noreferrer"},"HERE Maps places API")," ","for given categories as point input for the clustering algorithm which is implemented in",o.a.createElement("a",{href:"https://turfjs.org/docs/#clustersDbscan",target:"_blank",rel:"noopener noreferrer"},"TurfJS"),"."))),o.a.createElement(K.a,{as:"h5"},"DBScan settings"),o.a.createElement("div",{className:"flex flex-row"},o.a.createElement("div",{className:"w-80"},o.a.createElement(W.Slider,{discrete:!0,color:"grey",value:i.maxDistance,settings:{start:i.maxDistance,value:i.maxDistance,min:100,max:5e3,step:50,onChange:function(e){s(f({setting:"maxDistance",value:e}))}}}),o.a.createElement("div",{className:"mt2"},o.a.createElement(V.a,{content:"Maximum Distance \u03b5 between any point of the cluster to generate the clusters",trigger:o.a.createElement(q.a,{size:"tiny"},"Max. distance in meters: "+i.maxDistance)}))),o.a.createElement("div",{className:"w-80"},o.a.createElement(W.Slider,{discrete:!0,color:"grey",value:i,settings:{start:i.minPoints,value:i.minPoints,min:3,max:20,step:1,onChange:function(e){s(f({setting:"minPoints",value:e}))}}}),o.a.createElement("div",{className:"mt2"},o.a.createElement(V.a,{content:"Minimum number of points to generate a single cluster, points which do not meet this requirement will be classified as an 'edge' or 'noise'.",trigger:o.a.createElement(q.a,{size:"tiny"},"Min. points: "+i.minPoints)}))),o.a.createElement("div",{className:"w-20"},o.a.createElement(Y.a,{circular:!0,icon:"whmcs",disabled:X.a.isEmpty(a),onClick:this.handleClickDbscan}))),o.a.createElement($.a,null),o.a.createElement("div",null,o.a.createElement(ee.a,{active:n,style:{right:0,left:"unset"}}),Object.keys(ae).map(function(t,n){var i=!1;return a[ae[t].name]&&r===a[ae[t].name].boundingbox&&(i=!0),o.a.createElement("div",{key:n,className:"mt1 dib"},o.a.createElement(Y.a,{size:"tiny",disabled:i,loading:!!a[ae[t].name]&&a[ae[t].name].isFetching,onClick:e.handleClick,name:ae[t].name,color:ae[t].color},ae[t].name))}))),o.a.createElement(Q.SemanticToastContainer,{position:"bottom-center"}))}}]),t}(o.a.Component),oe=Object(c.b)(function(e){var t=e.placesControls,a=t.places,n=t.isCalculatingDbScan;return{places:a,boundingbox:t.boundingbox,isCalculatingDbScan:n,dbscanSettings:t.dbscanSettings,message:t.message}})(ne),re=function(e){function t(){return Object(O.a)(this,t),Object(j.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(G,null),o.a.createElement(oe,null))}}]),t}(o.a.Component),ie=(a(461),[l.a]),se=Object(i.createStore)(x,Object(s.composeWithDevTools)(i.applyMiddleware.apply(void 0,ie)));Object(r.render)(o.a.createElement(c.a,{store:se}," ",o.a.createElement(re,null)),document.getElementById("root"))}},[[286,1,2]]]);
//# sourceMappingURL=main.e1f7d005.chunk.js.map